{"version":3,"sources":["../../src/lib/download-wasm-swc.ts"],"names":["os","fs","path","Log","tar","fetch","fileExists","getRegistry","MAX_VERSIONS_TO_CACHE","downloadWasmSwc","version","wasmDirectory","variant","pkgName","tarFileName","substring","outputDirectory","join","cacheDirectory","result","envDefined","process","env","systemCacheDirectory","platform","XDG_CACHE_HOME","homedir","LOCALAPPDATA","dir","tmpdir","console","error","Error","exit","isAbsolute","resolve","cwd","promises","mkdir","recursive","extractFromTar","x","file","strip","info","tempFile","Date","now","registry","then","res","ok","status","cacheWriteStream","createWriteStream","Promise","reject","body","pipe","on","err","finally","close","rename","cacheFiles","readdir","length","sort","a","b","localeCompare","i","unlink","catch"],"mappings":"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"}